/*

Holder - 2.1 - client side image placeholders
(c) 2012-2013 Ivan Malopinsky / http://imsky.co

Provided under the MIT License.
Commercial use requires attribution.

*/
var Holder=Holder||{};(function(e,t){function f(e,t){var n="complete",r="readystatechange",i=!1,s=i,o=!0,u=e.document,a=u.documentElement,f=u.addEventListener?"addEventListener":"attachEvent",l=u.addEventListener?"removeEventListener":"detachEvent",c=u.addEventListener?"":"on",h=function(o){(o.type!=r||u.readyState==n)&&((o.type=="load"?e:u)[l](c+o.type,h,i),!s&&(s=!0)&&t.call(e,null))},p=function(){try{a.doScroll("left")}catch(e){setTimeout(p,50);return}h("poll")};if(u.readyState==n)t.call(e,"lazy");else{if(u.createEventObject&&a.doScroll){try{o=!e.frameElement}catch(d){}o&&p()}u[f](c+"DOMContentLoaded",h,i),u[f](c+r,h,i),e[f](c+"load",h,i)}}function l(e){e=e.match(/^(\W)?(.*)/);var t=document["getElement"+(e[1]?e[1]=="#"?"ById":"sByClassName":"sByTagName")](e[2]);var n=[];t!==null&&(t.length?n=t:t.length===0?n=t:n=[t]);return n}function c(e,t){var n={};for(var r in e)n[r]=e[r];for(var i in t)n[i]=t[i];return n}function h(e,t,n){t=parseInt(t,10);e=parseInt(e,10);var r=Math.max(t,e);var i=Math.min(t,e);var s=1/12;var o=Math.min(i*.75,.75*r*s);return{height:Math.round(Math.max(n.size,o))}}function p(e,t,n,r,s){var o=h(t.width,t.height,n);var u=o.height;var a=t.width*r,f=t.height*r;var l=n.font?n.font:"sans-serif";i.width=a;i.height=f;e.textAlign="center";e.textBaseline="middle";e.fillStyle=n.background;e.fillRect(0,0,a,f);e.fillStyle=n.foreground;e.font="bold "+u+"px "+l;var c=n.text?n.text:Math.floor(t.width)+"x"+Math.floor(t.height);if(s){c=n.literalText}var p=e.measureText(c).width;if(p/a>=.75){u=Math.floor(u*.75*(a/p))}e.font="bold "+u*r+"px "+l;e.fillText(c,a/2,f/2,a);return i.toDataURL("image/png")}function d(e,t,n,i){var o=n.dimensions,u=n.theme,f=n.text?decodeURIComponent(n.text):n.text;var l=o.width+"x"+o.height;u=f?c(u,{text:f}):u;u=n.font?c(u,{font:n.font}):u;t.setAttribute("data-src",i);u.literalText=l;n.originalTheme=n.theme;n.theme=u;if(e=="image"){t.setAttribute("alt",f?f:u.text?u.text+" ["+l+"]":l);if(r||!n.auto){t.style.width=o.width+"px";t.style.height=o.height+"px"}if(r){t.style.backgroundColor=u.background}else{t.setAttribute("src",p(s,o,u,a))}}else if(e=="background"){if(!r){t.style.backgroundImage="url("+p(s,o,u,a)+")";t.style.backgroundSize=o.width+"px "+o.height+"px"}}else if(e=="fluid"){t.setAttribute("alt",f?f:u.text?u.text+" ["+l+"]":l);if(o.height.slice(-1)=="%"){t.style.height=o.height}else{t.style.height=o.height+"px"}if(o.width.slice(-1)=="%"){t.style.width=o.width}else{t.style.width=o.width+"px"}if(t.style.display=="inline"||t.style.display===""){t.style.display="block"}if(r){t.style.backgroundColor=u.background}else{t.holderData=n;g.push(t);v(t)}}}function v(e){var t;if(e.nodeType==null){t=g}else{t=[e]}for(var n in t){var r=t[n];if(r.holderData){var i=r.holderData;r.setAttribute("src",p(s,{height:r.clientHeight,width:r.clientWidth},i.theme,a,!!i.literal))}}}function m(t,n){var r={theme:y.themes.gray};var i=false;for(sl=t.length,j=0;j<sl;j++){var s=t[j];if(e.flags.dimensions.match(s)){i=true;r.dimensions=e.flags.dimensions.output(s)}else if(e.flags.fluid.match(s)){i=true;r.dimensions=e.flags.fluid.output(s);r.fluid=true}else if(e.flags.literal.match(s)){r.literal=true}else if(e.flags.colors.match(s)){r.theme=e.flags.colors.output(s)}else if(n.themes[s]){r.theme=n.themes[s]}else if(e.flags.font.match(s)){r.font=e.flags.font.output(s)}else if(e.flags.auto.match(s)){r.auto=true}else if(e.flags.text.match(s)){r.text=e.flags.text.output(s)}}return i?r:false}var n=false,r=false,i=document.createElement("canvas");if(!i.getContext){r=true}else{if(i.toDataURL("image/png").indexOf("data:image/png")<0){r=true}else{var s=i.getContext("2d")}}var o=1,u=1;if(!r){o=window.devicePixelRatio||1,u=s.webkitBackingStorePixelRatio||s.mozBackingStorePixelRatio||s.msBackingStorePixelRatio||s.oBackingStorePixelRatio||s.backingStorePixelRatio||1}var a=o/u;document.getElementsByClassName||(document.getElementsByClassName=function(e){var t=document,n,r,i,s=[];if(t.querySelectorAll)return t.querySelectorAll("."+e);if(t.evaluate){r=".//*[contains(concat(' ', @class, ' '), ' "+e+" ')]",n=t.evaluate(r,t,null,0,null);while(i=n.iterateNext())s.push(i)}else{n=t.getElementsByTagName("*"),r=new RegExp("(^|\\s)"+e+"(\\s|$)");for(i=0;i<n.length;i++)r.test(n[i].className)&&s.push(n[i])}return s});window.getComputedStyle||(window.getComputedStyle=function(e){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return t=="float"&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle[t]?e.currentStyle[t]:null},this});if(!Object.prototype.hasOwnProperty)Object.prototype.hasOwnProperty=function(e){var t=this.__proto__||this.constructor.prototype;return e in this&&(!(e in t)||t[e]!==this[e])};var g=[];var y={domain:"holder.js",images:"img",bgnodes:".holderjs",themes:{gray:{background:"#eee",foreground:"#aaa",size:12},social:{background:"#3a5a97",foreground:"#fff",size:12},industrial:{background:"#434A52",foreground:"#C2F200",size:12}},stylesheet:""};e.flags={dimensions:{regex:/^(\d+)x(\d+)$/,output:function(e){var t=this.regex.exec(e);return{width:+t[1],height:+t[2]}}},fluid:{regex:/^([0-9%]+)x([0-9%]+)$/,output:function(e){var t=this.regex.exec(e);return{width:t[1],height:t[2]}}},colors:{regex:/#([0-9a-f]{3,})\:#([0-9a-f]{3,})/i,output:function(e){var t=this.regex.exec(e);return{size:y.themes.gray.size,foreground:"#"+t[2],background:"#"+t[1]}}},text:{regex:/text\:(.*)/,output:function(e){return this.regex.exec(e)[1]}},font:{regex:/font\:(.*)/,output:function(e){return this.regex.exec(e)[1]}},auto:{regex:/^auto$/},literal:{regex:/^literal$/}};for(var b in e.flags){if(!e.flags.hasOwnProperty(b))continue;e.flags[b].match=function(e){return e.match(this.regex)}}e.add_theme=function(t,n){t!=null&&n!=null&&(y.themes[t]=n);return e};e.add_image=function(t,n){var r=l(n);if(r.length){for(var i=0,s=r.length;i<s;i++){var o=document.createElement("img");o.setAttribute("data-src",t);r[i].appendChild(o)}}return e};e.run=function(t){var r=c(y,t),i=[],s=[],o=[];if(typeof r.images=="string"){s=l(r.images)}else if(window.NodeList&&r.images instanceof window.NodeList){s=r.images}else if(window.Node&&r.images instanceof window.Node){s=[r.images]}if(typeof r.bgnodes=="string"){o=l(r.bgnodes)}else if(window.NodeList&&r.elements instanceof window.NodeList){o=r.bgnodes}else if(window.Node&&r.bgnodes instanceof window.Node){o=[r.bgnodes]}n=true;for(h=0,f=s.length;h<f;h++)i.push(s[h]);var u=document.getElementById("holderjs-style");if(!u){u=document.createElement("style");u.setAttribute("id","holderjs-style");u.type="text/css";document.getElementsByTagName("head")[0].appendChild(u)}if(!r.nocss){if(u.styleSheet){u.styleSheet.cssText+=r.stylesheet}else{u.appendChild(document.createTextNode(r.stylesheet))}}var a=new RegExp(r.domain+'/(.*?)"?\\)');for(var f=o.length,h=0;h<f;h++){var p=window.getComputedStyle(o[h],null).getPropertyValue("background-image");var v=p.match(a);var g=o[h].getAttribute("data-background-src");if(v){var b=m(v[1].split("/"),r);if(b){d("background",o[h],b,p)}}else if(g!=null){var b=m(g.substr(g.lastIndexOf(r.domain)+r.domain.length+1).split("/"),r);if(b){d("background",o[h],b,p)}}}for(f=i.length,h=0;h<f;h++){var w,E;E=w=p=null;try{E=i[h].getAttribute("src");attr_datasrc=i[h].getAttribute("data-src")}catch(S){}if(attr_datasrc==null&&!!E&&E.indexOf(r.domain)>=0){p=E}else if(!!attr_datasrc&&attr_datasrc.indexOf(r.domain)>=0){p=attr_datasrc}if(p){var b=m(p.substr(p.lastIndexOf(r.domain)+r.domain.length+1).split("/"),r);if(b){if(b.fluid){d("fluid",i[h],b,p)}else{d("image",i[h],b,p)}}}}return e};f(t,function(){if(window.addEventListener){window.addEventListener("resize",v,false);window.addEventListener("orientationchange",v,false)}else{window.attachEvent("onresize",v)}n||e.run()});if(typeof define==="function"&&define.amd){define([],function(){return e})}})(Holder,window)